<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generative Hub31 AI Agent</title>
    <style>
        /* Previous styles remain unchanged */
        .warning {
            color: #ff4444;
            font-size: 0.9em;
            text-align: center;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <!-- Previous HTML structure remains the same -->

    <script>
        const HUGGING_FACE_API_KEY = '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';
        const COMPANY_CONTEXT = `Hub31 is a Kenyan tech agency specializing in:
        - Services: Web/Mobile apps, UI/UX, SEO, White Label Solutions
        - Industries: Healthcare, E-commerce, Education (10+ sectors)
        - Models: Fixed Cost, Dedicated Teams, Hourly Contracts
        - Differentiators: 24hr delivery, 40% cost savings, Kenyan-based
        Contact: WhatsApp +254720860034 | Nairobi HQ`;

        async function generateResponse(prompt) {
            try {
                const response = await fetch(
                    "https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2",
                    {
                        headers: { 
                            Authorization: `Bearer ${HUGGING_FACE_API_KEY}`,
                            "Content-Type": "application/json"
                        },
                        method: "POST",
                        body: JSON.stringify({
                            inputs: `<s>[INST]As Hub31 AI, answer using: ${COMPANY_CONTEXT}[/INST]
                            [INST]User: ${prompt}[/INST]
                            Hub31 AI:`,
                            parameters: {
                                max_new_tokens: 300,
                                temperature: 0.5,
                                repetition_penalty: 1.1
                            }
                        }),
                    }
                );
                
                const result = await response.json();
                return result[0]?.generated_text || "Let me connect you to our team via WhatsApp for this.";
            } catch (error) {
                console.error('API Error:', error);
                return "Please contact us directly via WhatsApp for immediate assistance ðŸ“±";
            }
        }

        // Modified handleUserInput with enhanced logic
        async function handleUserInput() {
            const input = document.getElementById('userInput').value.trim();
            if (!input) return;

            const chatMessages = document.getElementById('chatMessages');
            
            // Add user message
            chatMessages.innerHTML += `<div class="message user-message">
                ${input}
                <span class="timestamp">${getTime()}</span>
            </div>`;

            // Show loading
            const loadingId = Date.now();
            chatMessages.innerHTML += `<div class="message bot-message" id="${loadingId}">
                <div class="loading"></div>
                <span class="timestamp">${getTime()}</span>
            </div>`;
            
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Generate response
            let response;
            if(isBasicQuery(input)) {
                response = getPredefinedResponse(input);
            } else {
                response = await generateResponse(input);
                if(!validateResponse(response)) {
                    response = "For detailed answers, please contact us via WhatsApp directly.";
                }
            }

            // Update UI
            document.getElementById(loadingId).outerHTML = `
                <div class="message bot-message">
                    ${formatResponse(response)}
                    ${addFallbackOption(input)}
                    <span class="timestamp">${getTime()}</span>
                </div>
            `;

            chatMessages.scrollTop = chatMessages.scrollHeight;
            document.getElementById('userInput').value = '';
        }

        // Enhanced validation
        function validateResponse(text) {
            const forbiddenTerms = ['sorry', 'unable', 'cannot', 'don\'t know'];
            return !forbiddenTerms.some(term => text.toLowerCase().includes(term));
        }

        function addFallbackOption(input) {
            return `<div class="warning" style="margin-top:10px;">
                Not satisfied? 
                <a href="https://wa.me/254720860034?text=${encodeURIComponent(input)}" target="_blank">
                    Chat with human expert â†’
                </a>
            </div>`;
        }

        // Rest of previous JavaScript remains
    </script>
    
    <div class="warning">
        Note: This is a demo version. Always secure API keys in production systems.
    </div>
</body>
</html>